"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7264],{4350:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var n=t(4848),a=t(8453);const o={sidebar_position:5},r="Start_trip",l={id:"api/trip",title:"Start_trip",description:"Il metodo start_trip \xe8 un endpoint API creato per gestire l'avvio di un viaggio per un veicolo all'interno di un sistema di gestione. Utilizza Django per la gestione del database e thread per l'esecuzione asincrona di alcune operazioni.",source:"@site/pages/api/trip.md",sourceDirName:"api",slug:"/api/trip",permalink:"/docs/pages/api/trip",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/pages/api/trip.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"apiSidebar",previous:{title:"CONNECTIVITY_API",permalink:"/docs/pages/api/connectivity"}},s={},d=[{value:"Dettagli del Funzionamento:",id:"dettagli-del-funzionamento",level:2},{value:"Parametri:",id:"parametri",level:3},{value:"Funzionalit\xe0 Principali:",id:"funzionalit\xe0-principali",level:3},{value:"Logging del Comando Utente:",id:"logging-del-comando-utente",level:4},{value:"Controllo di Blacklist:",id:"controllo-di-blacklist",level:4},{value:"Gestione Pacchetti dell&#39;Utente:",id:"gestione-pacchetti-dellutente",level:4},{value:"Verifica dell&#39;Autorizzazione:",id:"verifica-dellautorizzazione",level:4},{value:"Gestione Pagamenti con Stripe:",id:"gestione-pagamenti-con-stripe",level:4},{value:"Avvio o Ripresa del Viaggio:",id:"avvio-o-ripresa-del-viaggio",level:4},{value:"Oggetti Utilizzati:",id:"oggetti-utilizzati",level:3},{value:"Esecuzione Asincrona:",id:"esecuzione-asincrona",level:2}];function c(e){const i={h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.header,{children:(0,n.jsx)(i.h1,{id:"start_trip",children:"Start_trip"})}),"\n",(0,n.jsx)(i.p,{children:"Il metodo start_trip \xe8 un endpoint API creato per gestire l'avvio di un viaggio per un veicolo all'interno di un sistema di gestione. Utilizza Django per la gestione del database e thread per l'esecuzione asincrona di alcune operazioni."}),"\n",(0,n.jsx)(i.h2,{id:"dettagli-del-funzionamento",children:"Dettagli del Funzionamento:"}),"\n",(0,n.jsx)(i.h3,{id:"parametri",children:"Parametri:"}),"\n",(0,n.jsx)(i.p,{children:"request: L'oggetto richiesta HTTP.\nid: L'identificatore univoco del veicolo.\nuser (str): Il nome utente.\nclient (str): L'identificatore del cliente.\nlat (float): Latitudine dell'utente.\nlng (float): Longitudine dell'utente.\nmode (str): Modalit\xe0 di avvio del viaggio (default = \"start\")."}),"\n",(0,n.jsx)(i.h3,{id:"funzionalit\xe0-principali",children:"Funzionalit\xe0 Principali:"}),"\n",(0,n.jsx)(i.h4,{id:"logging-del-comando-utente",children:"Logging del Comando Utente:"}),"\n",(0,n.jsx)(i.p,{children:'Viene creato un log del veicolo, registrando l\'ID del veicolo e il comando inviato (come "start").'}),"\n",(0,n.jsx)(i.h4,{id:"controllo-di-blacklist",children:"Controllo di Blacklist:"}),"\n",(0,n.jsx)(i.p,{children:"Il sistema verifica se l'utente \xe8 presente in una lista nera (blacklist) del cliente. Se s\xec, viene sollevata un'eccezione."}),"\n",(0,n.jsx)(i.h4,{id:"gestione-pacchetti-dellutente",children:"Gestione Pacchetti dell'Utente:"}),"\n",(0,n.jsx)(i.p,{children:"Viene eseguita una funzione asincrona in un thread separato per aggiornare i pacchetti associati all'utente e al cliente.\nSe un pacchetto pu\xf2 essere attivato e soddisfa le condizioni, viene attivato."}),"\n",(0,n.jsx)(i.h4,{id:"verifica-dellautorizzazione",children:"Verifica dell'Autorizzazione:"}),"\n",(0,n.jsx)(i.p,{children:'Il sistema controlla se l\'utente ha il permesso di avviare un viaggio (ruoli come "freeuse").'}),"\n",(0,n.jsx)(i.h4,{id:"gestione-pagamenti-con-stripe",children:"Gestione Pagamenti con Stripe:"}),"\n",(0,n.jsx)(i.p,{children:"Se il metodo di pagamento non \xe8 gestito dalla flotta, viene verificato se l'utente ha un metodo di pagamento registrato su Stripe.\nSe necessario, viene effettuata una pre-autorizzazione sul metodo di pagamento per un importo minimo."}),"\n",(0,n.jsx)(i.h4,{id:"avvio-o-ripresa-del-viaggio",children:"Avvio o Ripresa del Viaggio:"}),"\n",(0,n.jsx)(i.p,{children:'Se il viaggio non \xe8 una ripresa (resume), il viaggio viene avviato.\nSe il viaggio \xe8 una ripresa, lo stato del viaggio viene aggiornato a "running".'}),"\n",(0,n.jsx)(i.h3,{id:"oggetti-utilizzati",children:"Oggetti Utilizzati:"}),"\n",(0,n.jsx)(i.p,{children:"VehicleLog: Per registrare i comandi del veicolo.\nUserBlackList: Per verificare se un utente \xe8 bloccato.\nFleet: Per ottenere informazioni sulla flotta e sui veicoli associati.\nUserPackage: Per gestire i pacchetti attivi degli utenti.\nStripe: Per gestire i pagamenti e le pre-autorizzazioni.\nTrip: Per gestire e salvare i dettagli dei viaggi.\nPayment: Per memorizzare le informazioni sui pagamenti relativi al viaggio."}),"\n",(0,n.jsx)(i.h2,{id:"esecuzione-asincrona",children:"Esecuzione Asincrona:"}),"\n",(0,n.jsx)(i.p,{children:"La funzione update_packages_threaded viene eseguita in un thread separato per evitare di bloccare l'esecuzione principale.\nConsiderazioni:"}),"\n",(0,n.jsx)(i.p,{children:"Error Handling: Non sono presenti dettagli specifici su come vengono gestite alcune eccezioni. Sono presenti blocchi generici try-except.\nPre-Autorizzazione: Se l'importo della pre-autorizzazione supera i 2\u20ac, viene avviata una richiesta a Stripe per la pre-autorizzazione."})]})}function u(e={}){const{wrapper:i}={...(0,a.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,i,t)=>{t.d(i,{R:()=>r,x:()=>l});var n=t(6540);const a={},o=n.createContext(a);function r(e){const i=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),n.createElement(o.Provider,{value:i},e.children)}}}]);