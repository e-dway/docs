"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[734],{8491:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>s,default:()=>p,frontMatter:()=>t,metadata:()=>d,toc:()=>a});var r=n(4848),l=n(8453);const t={sidebar_position:1},s="Overview",d={id:"api/intro",title:"Overview",description:"Questo file rappresenta una API costruita utilizzando FastAPI, un framework moderno e performante per la creazione di API in Python. Di seguito vengono descritte le principali componenti del file.",source:"@site/pages/api/intro.md",sourceDirName:"api",slug:"/api/intro",permalink:"/docs/pages/api/intro",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/pages/api/intro.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"apiSidebar",next:{title:"Autenticazione e Registrazione",permalink:"/docs/pages/api/auth"}},o={},a=[{value:"1. <strong>Importazioni Principali</strong>",id:"1-importazioni-principali",level:2},{value:"2. <strong>Inizializzazione di Sentry</strong>",id:"2-inizializzazione-di-sentry",level:2},{value:"3. **Definizione degli <strong>OWNERS</strong>",id:"3-definizione-degli-owners",level:2},{value:"4. <strong>Funzione <code>get_client_id</code></strong>",id:"4-funzione-get_client_id",level:2},{value:"5. <strong>Impostazione di FastAPI</strong>",id:"5-impostazione-di-fastapi",level:2},{value:"Middleware CORS",id:"middleware-cors",level:3},{value:"Middleware di Sentry",id:"middleware-di-sentry",level:3},{value:"Middleware di Prometheus",id:"middleware-di-prometheus",level:3},{value:"6. <strong>Middleware Personalizzato</strong>",id:"6-middleware-personalizzato",level:2},{value:"Funzionalit\xe0 del Middleware:",id:"funzionalit\xe0-del-middleware",level:3},{value:"7. <strong>Rotte</strong>",id:"7-rotte",level:2},{value:"Modalit\xe0 <strong>Front</strong>",id:"modalit\xe0-front",level:3},{value:"Modalit\xe0 <strong>Admin</strong>",id:"modalit\xe0-admin",level:3},{value:"8. <strong>Gestione delle Eccezioni</strong>",id:"8-gestione-delle-eccezioni",level:2},{value:"9. <strong>Eventi di Startup</strong>",id:"9-eventi-di-startup",level:2},{value:"<strong>Funzionalit\xe0 principali del file</strong>:",id:"funzionalit\xe0-principali-del-file",level:3}];function c(e){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"overview",children:"Overview"})}),"\n",(0,r.jsxs)(i.p,{children:["Questo file rappresenta una ",(0,r.jsx)(i.strong,{children:"API"})," costruita utilizzando ",(0,r.jsx)(i.strong,{children:"FastAPI"}),", un framework moderno e performante per la creazione di API in Python. Di seguito vengono descritte le principali componenti del file."]}),"\n",(0,r.jsxs)(i.h2,{id:"1-importazioni-principali",children:["1. ",(0,r.jsx)(i.strong,{children:"Importazioni Principali"})]}),"\n",(0,r.jsx)(i.p,{children:"Il file importa una serie di moduli e pacchetti necessari per l'API:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"FastAPI"}),": Framework utilizzato per costruire l'API."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Depends, Request"}),": Utilizzati per gestire le dipendenze e le richieste HTTP."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"JSONResponse"}),": Per la gestione delle risposte in formato JSON."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Vari moduli"})," da ",(0,r.jsx)(i.code,{children:"routes"})," e ",(0,r.jsx)(i.code,{children:"adminroute"}),": Questi moduli contengono i vari router per la gestione delle differenti rotte dell'API (ad esempio, autenticazione, veicoli, wallet, etc.)."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Middleware CORS"}),": Per gestire le richieste CORS."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Sentry SDK"}),": Utilizzato per monitorare errori e performance."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Prometheus"}),": Per monitorare le metriche delle API."]}),"\n"]}),"\n",(0,r.jsxs)(i.h2,{id:"2-inizializzazione-di-sentry",children:["2. ",(0,r.jsx)(i.strong,{children:"Inizializzazione di Sentry"})]}),"\n",(0,r.jsxs)(i.p,{children:["Il codice utilizza ",(0,r.jsx)(i.strong,{children:"Sentry"})," per la gestione e il tracciamento degli errori."]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:'sentry_sdk.init(\n    dsn="https://47f854ad8122440abb4f276a1f1d2498@o1303050.ingest.sentry.io/6541522",\n    traces_sample_rate=1.0\n)\n'})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"dsn"}),": Collegamento con il progetto Sentry per monitorare l'API."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"traces_sample_rate"}),": Configurato al 100% per catturare tutte le transazioni ai fini del monitoraggio delle performance."]}),"\n"]}),"\n",(0,r.jsxs)(i.h2,{id:"3-definizione-degli-owners",children:["3. **Definizione degli ",(0,r.jsx)(i.strong,{children:"OWNERS"})]}),"\n",(0,r.jsxs)(i.p,{children:["Il codice definisce una lista di ",(0,r.jsx)(i.strong,{children:"OWNERS"}),", che rappresentano i proprietari dell'applicazione o della flotta. Ogni owner ha un ",(0,r.jsx)(i.code,{children:"ident"}),", ",(0,r.jsx)(i.code,{children:"name"}),", un eventuale ",(0,r.jsx)(i.code,{children:"telegram_group"}),", uno stato ",(0,r.jsx)(i.code,{children:"enabled"}),", e un ",(0,r.jsx)(i.code,{children:"app_code"}),"."]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:'OWNERS = [\n    {"ident": "0927fbde-9179-45e4-ac11-377cc8d77e0b", "name": "TrendyRent", ...},\n    {"ident": "bca58791-f1a5-49ab-a1a7-ff7ef9944328", "name": "Elerent", ...},\n    # Altri owners...\n]\n'})}),"\n",(0,r.jsxs)(i.p,{children:["Viene inoltre definito il dizionario ",(0,r.jsx)(i.code,{children:"ROWNERS"}),", che associa i codici dell'applicazione (",(0,r.jsx)(i.code,{children:"app_code"}),") agli ",(0,r.jsx)(i.code,{children:"ident"})," dei proprietari."]}),"\n",(0,r.jsxs)(i.h2,{id:"4-funzione-get_client_id",children:["4. ",(0,r.jsxs)(i.strong,{children:["Funzione ",(0,r.jsx)(i.code,{children:"get_client_id"})]})]}),"\n",(0,r.jsx)(i.p,{children:"Questa funzione recupera l'ID del client in base al codice del bundle fornito."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"def get_client_id(code):\n    return ROWNERS.get(code, code)\n"})}),"\n",(0,r.jsxs)(i.h2,{id:"5-impostazione-di-fastapi",children:["5. ",(0,r.jsx)(i.strong,{children:"Impostazione di FastAPI"})]}),"\n",(0,r.jsxs)(i.p,{children:["L'oggetto principale dell'applicazione ",(0,r.jsx)(i.strong,{children:"FastAPI"})," viene istanziato:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"app = FastAPI()\n"})}),"\n",(0,r.jsx)(i.h3,{id:"middleware-cors",children:"Middleware CORS"}),"\n",(0,r.jsxs)(i.p,{children:["Un middleware viene aggiunto per gestire le politiche di ",(0,r.jsx)(i.strong,{children:"CORS"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:'app.add_middleware(\n    CORSMiddleware,\n    allow_origins=["*"],\n    allow_credentials=True,\n    allow_methods=["*"],\n    allow_headers=["*"],\n)\n'})}),"\n",(0,r.jsx)(i.h3,{id:"middleware-di-sentry",children:"Middleware di Sentry"}),"\n",(0,r.jsxs)(i.p,{children:["Viene integrato ",(0,r.jsx)(i.strong,{children:"Sentry"})," come middleware per il monitoraggio:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"app.add_middleware(SentryAsgiMiddleware)\n"})}),"\n",(0,r.jsx)(i.h3,{id:"middleware-di-prometheus",children:"Middleware di Prometheus"}),"\n",(0,r.jsxs)(i.p,{children:["Viene configurato ",(0,r.jsx)(i.strong,{children:"Prometheus"})," per la raccolta delle metriche:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"from prometheus_fastapi_instrumentator import Instrumentator\ninstrumentator = Instrumentator().instrument(app)\n"})}),"\n",(0,r.jsxs)(i.h2,{id:"6-middleware-personalizzato",children:["6. ",(0,r.jsx)(i.strong,{children:"Middleware Personalizzato"})]}),"\n",(0,r.jsx)(i.p,{children:"Un middleware personalizzato misura il tempo di esecuzione delle richieste e aggiunge informazioni sugli header."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:'@app.middleware("http")\nasync def add_process_time_header(request: Request, call_next):\n    tin = time.time()\n    # Gestione degli header e client ID\n    ...\n    response = await call_next(request)\n    response.headers[\'Server-Timing\'] = ", ".join(srv)\n    response.headers[\'Fleet-Id\'] = "a3b50810-875c-47ff-b427-509f98c34cee"\n    return response\n'})}),"\n",(0,r.jsx)(i.h3,{id:"funzionalit\xe0-del-middleware",children:"Funzionalit\xe0 del Middleware:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Client ID dinamico"}),": Se il ",(0,r.jsx)(i.code,{children:"client-id"})," non \xe8 presente nell'intestazione della richiesta, viene generato in base al ",(0,r.jsx)(i.code,{children:"bundle-id"}),"."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Server-Timing"}),": Aggiunge il tempo di esecuzione della richiesta negli header della risposta."]}),"\n"]}),"\n",(0,r.jsxs)(i.h2,{id:"7-rotte",children:["7. ",(0,r.jsx)(i.strong,{children:"Rotte"})]}),"\n",(0,r.jsxs)(i.p,{children:["Le rotte dell'API sono organizzate in modo modulare utilizzando ",(0,r.jsx)(i.strong,{children:"router"}),". Questi sono inclusi all'interno di due modalit\xe0 distinte: ",(0,r.jsx)(i.code,{children:"front"})," e ",(0,r.jsx)(i.code,{children:"admin"}),"."]}),"\n",(0,r.jsxs)(i.h3,{id:"modalit\xe0-front",children:["Modalit\xe0 ",(0,r.jsx)(i.strong,{children:"Front"})]}),"\n",(0,r.jsx)(i.p,{children:"Include rotte per autenticazione, gestione veicoli, pagamenti, wallet, prodotti, ecc."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:'if "front" in MODES:\n    app.include_router(auth.router, prefix="/auth")\n    app.include_router(fleet.router, prefix="/fleet")\n    ...\n'})}),"\n",(0,r.jsxs)(i.h3,{id:"modalit\xe0-admin",children:["Modalit\xe0 ",(0,r.jsx)(i.strong,{children:"Admin"})]}),"\n",(0,r.jsx)(i.p,{children:"Include rotte per la gestione amministrativa, come bot, impostazioni, ecc."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:'if "admin" in MODES:\n    app.include_router(auth.router, prefix="/auth")\n    app.include_router(adminroute, prefix="/admin")\n    ...\n'})}),"\n",(0,r.jsxs)(i.h2,{id:"8-gestione-delle-eccezioni",children:["8. ",(0,r.jsx)(i.strong,{children:"Gestione delle Eccezioni"})]}),"\n",(0,r.jsx)(i.p,{children:"Viene implementato un handler personalizzato per le eccezioni HTTP."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"@app.exception_handler(StarletteHTTPException)\nasync def http_exception_handler(request, exc):\n    return JSONResponse(\n        status_code=exc.status_code,\n        content=exc.detail\n    )\n"})}),"\n",(0,r.jsxs)(i.h2,{id:"9-eventi-di-startup",children:["9. ",(0,r.jsx)(i.strong,{children:"Eventi di Startup"})]}),"\n",(0,r.jsxs)(i.p,{children:["Alla partenza dell'applicazione, viene inizializzato un backend ",(0,r.jsx)(i.strong,{children:"Redis"})," per la cache."]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:'@app.on_event("startup")\nasync def startup():\n    redis = aioredis.from_url("redis://api_cache", encoding="utf8", decode_responses=True)\n    FastAPICache.init(RedisBackend(redis), prefix="fastapi-cache")\n    instrumentator.expose(app)\n'})}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsxs)(i.h3,{id:"funzionalit\xe0-principali-del-file",children:[(0,r.jsx)(i.strong,{children:"Funzionalit\xe0 principali del file"}),":"]}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Sentry"}),": Monitoraggio degli errori e delle performance."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Middleware"}),": Gestione delle richieste HTTP con misurazione del tempo di esecuzione e modifica dinamica degli header."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"CORS"}),": Middleware configurato per accettare richieste da qualsiasi origine."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Prometheus"}),": Integrazione per il monitoraggio delle metriche."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Modularit\xe0"}),": Suddivisione delle rotte in base alle modalit\xe0 di utilizzo (",(0,r.jsx)(i.code,{children:"front"})," e ",(0,r.jsx)(i.code,{children:"admin"}),")."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Gestione Cache"}),": Integrazione di ",(0,r.jsx)(i.strong,{children:"Redis"})," per la gestione della cache."]}),"\n"]}),"\n",(0,r.jsx)(i.hr,{})]})}function p(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>s,x:()=>d});var r=n(6540);const l={},t=r.createContext(l);function s(e){const i=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),r.createElement(t.Provider,{value:i},e.children)}}}]);