"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[820],{4335:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var t=n(4848),r=n(8453);const l={sidebar_position:2},a="Autenticazione e Registrazione",s={id:"api/auth",title:"Autenticazione e Registrazione",description:"Questo file Python implementa le rotte di autenticazione e registrazione di un'API utilizzando FastAPI.",source:"@site/pages/api/auth.md",sourceDirName:"api",slug:"/api/auth",permalink:"/docs/pages/api/auth",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/pages/api/auth.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"apiSidebar",previous:{title:"Overview",permalink:"/docs/pages/api/intro"},next:{title:"Fleet Management",permalink:"/docs/pages/api/fleet"}},o={},d=[{value:"1. <strong>Importazioni Principali</strong>",id:"1-importazioni-principali",level:2},{value:"2. <strong>Variabili d&#39;Ambiente</strong>",id:"2-variabili-dambiente",level:2},{value:"3. <strong>Rotte Principali</strong>",id:"3-rotte-principali",level:2},{value:"<code>/validate/{email}/{code}</code>",id:"validateemailcode",level:3},{value:"<code>/register/template</code>",id:"registertemplate",level:3},{value:"<code>/register</code>",id:"register",level:3},{value:"<code>/del</code>",id:"del",level:3},{value:"<code>/reset</code>",id:"reset",level:3},{value:"<code>/otp</code>",id:"otp",level:3},{value:"<code>/login</code>",id:"login",level:3},{value:"<code>/telegram</code>",id:"telegram",level:3},{value:"<code>/logout</code>",id:"logout",level:3},{value:"<code>/send_registration_email</code>",id:"send_registration_email",level:3},{value:"<code>/verify_registration_email</code>",id:"verify_registration_email",level:3},{value:"<code>/refresh</code>",id:"refresh",level:3},{value:"4. <strong>Funzioni Principali</strong>",id:"4-funzioni-principali",level:2},{value:"<code>generateOTP(itms=6)</code>",id:"generateotpitms6",level:3},{value:"<code>get_token()</code>",id:"get_token",level:3},{value:"<code>become_admin()</code>",id:"become_admin",level:3},{value:"<code>register_user(username, password, email, firstname, lastname)</code>",id:"register_userusername-password-email-firstname-lastname",level:3},{value:"<code>send_email(recipient, subject, text, html)</code>",id:"send_emailrecipient-subject-text-html",level:3},{value:"5. <strong>Autenticazione con Keycloak</strong>",id:"5-autenticazione-con-keycloak",level:2},{value:"6. <strong>Gestione delle OTP</strong>",id:"6-gestione-delle-otp",level:2},{value:"7. <strong>Integrazione con Stripe</strong>",id:"7-integrazione-con-stripe",level:2},{value:"8. <strong>Funzioni di Sicurezza</strong>",id:"8-funzioni-di-sicurezza",level:2}];function c(e){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"autenticazione-e-registrazione",children:"Autenticazione e Registrazione"})}),"\n",(0,t.jsxs)(i.p,{children:["Questo file Python implementa le rotte di autenticazione e registrazione di un'API utilizzando ",(0,t.jsx)(i.strong,{children:"FastAPI"}),"."]}),"\n",(0,t.jsxs)(i.h2,{id:"1-importazioni-principali",children:["1. ",(0,t.jsx)(i.strong,{children:"Importazioni Principali"})]}),"\n",(0,t.jsx)(i.p,{children:"Il file importa una serie di moduli essenziali per l'API:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"FastAPI"}),": Framework utilizzato per la creazione dell'API."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"pydantic"}),": Per la validazione dei dati in modo tipizzato."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Requests"}),": Libreria per effettuare richieste HTTP esterne."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"JWT"}),": Per la gestione dei token JWT per l'autenticazione."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Dateutil"}),": Utilizzata per la gestione di date e scadenze."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"dotenv"}),": Per caricare le variabili d'ambiente da un file ",(0,t.jsx)(i.code,{children:".env"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(i.h2,{id:"2-variabili-dambiente",children:["2. ",(0,t.jsx)(i.strong,{children:"Variabili d'Ambiente"})]}),"\n",(0,t.jsx)(i.p,{children:"Il file carica una serie di variabili d'ambiente essenziali per il funzionamento dell'API:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"KEYCLOAK_SERVER"}),": URL del server Keycloak per la gestione degli utenti."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"PERMISSIONS_API"}),", ",(0,t.jsx)(i.strong,{children:"VEHICLES_API"}),", ",(0,t.jsx)(i.strong,{children:"BOT_API"}),": URL dei servizi di backend associati."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"SMTP_EMAIL_SERVER_"}),"*: Configurazione del server SMTP per l'invio di email."]}),"\n"]}),"\n",(0,t.jsxs)(i.h2,{id:"3-rotte-principali",children:["3. ",(0,t.jsx)(i.strong,{children:"Rotte Principali"})]}),"\n",(0,t.jsx)(i.h3,{id:"validateemailcode",children:(0,t.jsx)(i.code,{children:"/validate/{email}/{code}"})}),"\n",(0,t.jsx)(i.p,{children:"Questa rotta permette di validare un indirizzo email in base al codice di verifica inviato."}),"\n",(0,t.jsx)(i.h3,{id:"registertemplate",children:(0,t.jsx)(i.code,{children:"/register/template"})}),"\n",(0,t.jsx)(i.p,{children:"Restituisce un template di campi necessari per registrare un nuovo utente."}),"\n",(0,t.jsx)(i.h3,{id:"register",children:(0,t.jsx)(i.code,{children:"/register"})}),"\n",(0,t.jsx)(i.p,{children:"Questa rotta permette di registrare un nuovo utente. Valida i dati forniti nel payload e verifica che l'utente abbia accettato i termini legali e la privacy. Esegue anche controlli come l'et\xe0 minima dell'utente."}),"\n",(0,t.jsx)(i.h3,{id:"del",children:(0,t.jsx)(i.code,{children:"/del"})}),"\n",(0,t.jsx)(i.p,{children:"Permette di eliminare un utente tramite un'operazione amministrativa."}),"\n",(0,t.jsx)(i.h3,{id:"reset",children:(0,t.jsx)(i.code,{children:"/reset"})}),"\n",(0,t.jsx)(i.p,{children:"Permette di resettare la password dell'utente, generando una nuova password temporanea e inviandola all'utente tramite SMS o email."}),"\n",(0,t.jsx)(i.h3,{id:"otp",children:(0,t.jsx)(i.code,{children:"/otp"})}),"\n",(0,t.jsx)(i.p,{children:"Questa rotta gestisce la verifica tramite OTP (One Time Password). Il processo prevede la decodifica e validazione dell'OTP ricevuto."}),"\n",(0,t.jsx)(i.h3,{id:"login",children:(0,t.jsx)(i.code,{children:"/login"})}),"\n",(0,t.jsx)(i.p,{children:"Permette il login di un utente utilizzando credenziali standard o un token OTP. Se le credenziali sono valide, restituisce un token JWT."}),"\n",(0,t.jsx)(i.h3,{id:"telegram",children:(0,t.jsx)(i.code,{children:"/telegram"})}),"\n",(0,t.jsx)(i.p,{children:"Gestisce l'autenticazione tramite Telegram, richiedendo informazioni sul'utente e completando la procedura di autenticazione."}),"\n",(0,t.jsx)(i.h3,{id:"logout",children:(0,t.jsx)(i.code,{children:"/logout"})}),"\n",(0,t.jsx)(i.p,{children:"Disconnette l'utente, invalidando il token di accesso corrente."}),"\n",(0,t.jsx)(i.h3,{id:"send_registration_email",children:(0,t.jsx)(i.code,{children:"/send_registration_email"})}),"\n",(0,t.jsx)(i.p,{children:"Invia un'email di conferma registrazione all'utente. Il link nell'email contiene un token JWT per la verifica dell'indirizzo email."}),"\n",(0,t.jsx)(i.h3,{id:"verify_registration_email",children:(0,t.jsx)(i.code,{children:"/verify_registration_email"})}),"\n",(0,t.jsx)(i.p,{children:"Verifica il token contenuto nell'email di registrazione e conferma l'indirizzo email dell'utente."}),"\n",(0,t.jsx)(i.h3,{id:"refresh",children:(0,t.jsx)(i.code,{children:"/refresh"})}),"\n",(0,t.jsx)(i.p,{children:"Permette di rinnovare un token di accesso JWT tramite un token di refresh."}),"\n",(0,t.jsxs)(i.h2,{id:"4-funzioni-principali",children:["4. ",(0,t.jsx)(i.strong,{children:"Funzioni Principali"})]}),"\n",(0,t.jsx)(i.h3,{id:"generateotpitms6",children:(0,t.jsx)(i.code,{children:"generateOTP(itms=6)"})}),"\n",(0,t.jsx)(i.p,{children:"Genera una OTP (One Time Password) casuale composta da numeri."}),"\n",(0,t.jsx)(i.h3,{id:"get_token",children:(0,t.jsx)(i.code,{children:"get_token()"})}),"\n",(0,t.jsx)(i.p,{children:"Effettua una richiesta al server Keycloak per ottenere un token di accesso."}),"\n",(0,t.jsx)(i.h3,{id:"become_admin",children:(0,t.jsx)(i.code,{children:"become_admin()"})}),"\n",(0,t.jsx)(i.p,{children:"Restituisce un header con il token di accesso di un amministratore per effettuare richieste amministrative."}),"\n",(0,t.jsx)(i.h3,{id:"register_userusername-password-email-firstname-lastname",children:(0,t.jsx)(i.code,{children:"register_user(username, password, email, firstname, lastname)"})}),"\n",(0,t.jsx)(i.p,{children:"Registra un nuovo utente su Keycloak creando l'utente con i parametri forniti."}),"\n",(0,t.jsx)(i.h3,{id:"send_emailrecipient-subject-text-html",children:(0,t.jsx)(i.code,{children:"send_email(recipient, subject, text, html)"})}),"\n",(0,t.jsx)(i.p,{children:"Invia un'email tramite un server SMTP con i parametri forniti (destinatario, oggetto, testo e HTML)."}),"\n",(0,t.jsxs)(i.h2,{id:"5-autenticazione-con-keycloak",children:["5. ",(0,t.jsx)(i.strong,{children:"Autenticazione con Keycloak"})]}),"\n",(0,t.jsxs)(i.p,{children:["Il file integra ",(0,t.jsx)(i.strong,{children:"Keycloak"})," per la gestione dell'autenticazione e dell'autorizzazione. Utilizza le API di Keycloak per:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Creare e gestire utenti."}),"\n",(0,t.jsx)(i.li,{children:"Resettare le password."}),"\n",(0,t.jsx)(i.li,{children:"Verificare l'identit\xe0 degli utenti con i token JWT."}),"\n"]}),"\n",(0,t.jsxs)(i.h2,{id:"6-gestione-delle-otp",children:["6. ",(0,t.jsx)(i.strong,{children:"Gestione delle OTP"})]}),"\n",(0,t.jsx)(i.p,{children:"Le OTP vengono utilizzate in pi\xf9 rotte, sia per la registrazione che per la verifica degli utenti. L'implementazione prevede:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"La generazione di OTP."}),"\n",(0,t.jsx)(i.li,{children:"L'invio delle OTP via SMS o email."}),"\n",(0,t.jsx)(i.li,{children:"La verifica della validit\xe0 delle OTP fornite."}),"\n"]}),"\n",(0,t.jsxs)(i.h2,{id:"7-integrazione-con-stripe",children:["7. ",(0,t.jsx)(i.strong,{children:"Integrazione con Stripe"})]}),"\n",(0,t.jsxs)(i.p,{children:["Durante la registrazione, se l'utente appartiene a un cliente che utilizza ",(0,t.jsx)(i.strong,{children:"Stripe"})," come sistema di pagamento, viene creato un cliente su Stripe utilizzando l'API di Stripe."]}),"\n",(0,t.jsxs)(i.h2,{id:"8-funzioni-di-sicurezza",children:["8. ",(0,t.jsx)(i.strong,{children:"Funzioni di Sicurezza"})]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Criptazione"}),": Viene utilizzato il modulo ",(0,t.jsx)(i.strong,{children:"Fernet"})," per criptare i token e le OTP."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Verifica dei token JWT"}),": Utilizzato per autenticare gli utenti e garantire che le richieste siano effettuate da utenti autenticati."]}),"\n"]}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.p,{children:"Questo file fornisce una solida infrastruttura per la gestione di utenti, autenticazione e registrazione tramite FastAPI e Keycloak. Le funzioni di sicurezza come l'integrazione con JWT, OTP e Stripe garantiscono che l'API sia sicura e scalabile."})]})}function u(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>s});var t=n(6540);const r={},l=t.createContext(r);function a(e){const i=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(l.Provider,{value:i},e.children)}}}]);